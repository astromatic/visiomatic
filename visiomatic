#! /usr/bin/python
import os, pickle

import uvicorn

from visiomatic.server.settings import (
    config_settings,
    default_settings,
    settings2parser
    )

def start_server(
        app="src.visiomatic.server.app:create_app",
        host="localhost",
        port=8009,
        root_path="",
        workers=4,
        access_log=False,
        reload=True
    ):
    uvicorn.run(
        app,
        host=host,
        port=port,
        root_path=root_path,
        access_log=access_log,
        workers=workers,
        reload=reload,
        factory=True
    )
    return

if __name__ == "__main__":
    import configparser
    from argparse import ArgumentParser

    from visiomatic import package

    print(f"{package.title} v{package.version}")

    # Parse command-line
    parser = ArgumentParser(description=package.description)
    parser.add_argument(
        "-c", "--config",
        type=str, default=config_settings.config,
        help=config_settings.config.title, 
        metavar="FILE"
    )

    settings2parser(default_settings, parser)

    args = vars(parser.parse_args())
    '''
    start_server(
        host=args["host"],
        port=args["port"],
        root_path=args["root_path"],
        access_log=args["access_log"],
        reload=args["reload"],
        workers=args["workers"]
    )
    '''
